import { useState } from 'react';
import { FileText, Download, Send, BarChart3, Shield, TrendingUp } from 'lucide-react';
import { Card } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Separator } from '@/components/ui/separator';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';

interface ReportModuleProps {
  target: string;
}

export const ReportModule = ({ target }: ReportModuleProps) => {
  const [reportFormat, setReportFormat] = useState('executive');

  const executiveSummary = {
    target: target || "example.com",
    testDate: new Date().toLocaleDateString(),
    tester: "Cybersecurity Analyst",
    scope: "External Network Penetration Test",
    findings: {
      critical: 2,
      high: 3,
      medium: 1,
      low: 0,
      total: 6
    },
    riskRating: "High",
    businessImpact: "Immediate attention required for critical vulnerabilities"
  };

  const technicalFindings = [
    {
      id: "F001",
      title: "SQL Injection in Admin Panel",
      severity: "Critical",
      cvss: "9.8",
      affected: "/admin/login.php",
      impact: "Complete database compromise, data theft, unauthorized access",
      recommendation: "Implement parameterized queries and input validation"
    },
    {
      id: "F002", 
      title: "Kernel Privilege Escalation",
      severity: "Critical",
      cvss: "9.8",
      affected: "Linux Kernel 5.4.0",
      impact: "Local privilege escalation to root access",
      recommendation: "Update kernel to patched version immediately"
    },
    {
      id: "F003",
      title: "Cross-Site Scripting (XSS)",
      severity: "High",
      cvss: "7.2",
      affected: "/search.php",
      impact: "Session hijacking, credential theft, malicious content injection",
      recommendation: "Implement output encoding and Content Security Policy"
    }
  ];

  const reportTypes = [
    { id: 'executive', name: 'Executive Summary', desc: 'High-level overview for management' },
    { id: 'technical', name: 'Technical Report', desc: 'Detailed technical findings' },
    { id: 'compliance', name: 'Compliance Report', desc: 'Regulatory compliance assessment' }
  ];

  const exportReport = (format: string) => {
    // Simulate report export
    console.log(`Exporting ${reportFormat} report in ${format} format`);
  };

  return (
    <div className="space-y-6">
      <Card className="terminal">
        <div className="flex items-center justify-between mb-6">
          <h2 className="text-xl font-bold text-primary">Penetration Test Report</h2>
          <div className="flex items-center space-x-3">
            <Select value={reportFormat} onValueChange={setReportFormat}>
              <SelectTrigger className="w-48">
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                {reportTypes.map((type) => (
                  <SelectItem key={type.id} value={type.id}>
                    {type.name}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
            <Button variant="outline" onClick={() => exportReport('pdf')}>
              <Download className="h-4 w-4 mr-2" />
              Export PDF
            </Button>
          </div>
        </div>

        {/* Report Header */}
        <Card className="bg-secondary/30 border-l-4 border-l-primary mb-6">
          <div className="p-6">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <h3 className="font-semibold text-lg text-foreground mb-4">Test Information</h3>
                <div className="space-y-2 text-sm">
                  <div className="flex justify-between">
                    <span className="text-muted-foreground">Target:</span>
                    <span className="font-mono text-foreground">{executiveSummary.target}</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-muted-foreground">Test Date:</span>
                    <span className="text-foreground">{executiveSummary.testDate}</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-muted-foreground">Tester:</span>
                    <span className="text-foreground">{executiveSummary.tester}</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-muted-foreground">Scope:</span>
                    <span className="text-foreground">{executiveSummary.scope}</span>
                  </div>
                </div>
              </div>
              <div>
                <h3 className="font-semibold text-lg text-foreground mb-4">Risk Assessment</h3>
                <div className="text-center">
                  <Badge className="text-lg px-4 py-2 danger-glow bg-destructive">
                    {executiveSummary.riskRating} Risk
                  </Badge>
                  <p className="text-sm text-muted-foreground mt-2">
                    {executiveSummary.businessImpact}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </Card>

        {reportFormat === 'executive' && (
          <>
            {/* Executive Summary */}
            <Card className="bg-secondary/30 border-l-4 border-l-accent mb-6">
              <div className="p-6">
                <h3 className="font-semibold text-lg text-foreground mb-4 flex items-center">
                  <BarChart3 className="h-5 w-5 mr-2" />
                  Executive Summary
                </h3>
                <div className="grid grid-cols-2 md:grid-cols-5 gap-4 mb-4">
                  <div className="text-center">
                    <div className="text-2xl font-bold text-destructive">{executiveSummary.findings.critical}</div>
                    <div className="text-sm text-muted-foreground">Critical</div>
                  </div>
                  <div className="text-center">
                    <div className="text-2xl font-bold text-orange-500">{executiveSummary.findings.high}</div>
                    <div className="text-sm text-muted-foreground">High</div>
                  </div>
                  <div className="text-center">
                    <div className="text-2xl font-bold text-warning">{executiveSummary.findings.medium}</div>
                    <div className="text-sm text-muted-foreground">Medium</div>
                  </div>
                  <div className="text-center">
                    <div className="text-2xl font-bold text-primary">{executiveSummary.findings.low}</div>
                    <div className="text-sm text-muted-foreground">Low</div>
                  </div>
                  <div className="text-center">
                    <div className="text-2xl font-bold text-foreground">{executiveSummary.findings.total}</div>
                    <div className="text-sm text-muted-foreground">Total</div>
                  </div>
                </div>
                <Separator className="my-4" />
                <div className="prose prose-sm max-w-none text-muted-foreground">
                  <p>
                    This penetration test identified <strong className="text-destructive">{executiveSummary.findings.critical} critical</strong> and{' '}
                    <strong className="text-orange-500">{executiveSummary.findings.high} high-severity</strong> vulnerabilities that pose immediate risks to the organization.
                    The critical findings include SQL injection vulnerabilities and kernel-level privilege escalation flaws that could result in complete system compromise.
                  </p>
                  <p className="mt-3">
                    <strong className="text-foreground">Immediate Action Required:</strong> Address critical vulnerabilities within 24-48 hours to prevent potential data breaches and system compromise.
                    High-severity issues should be resolved within 1-2 weeks.
                  </p>
                </div>
              </div>
            </Card>

            {/* Business Impact */}
            <Card className="bg-secondary/30 border-l-4 border-l-warning mb-6">
              <div className="p-6">
                <h3 className="font-semibold text-lg text-foreground mb-4 flex items-center">
                  <TrendingUp className="h-5 w-5 mr-2" />
                  Business Impact Analysis
                </h3>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div className="bg-destructive/10 border border-destructive/20 p-4 rounded">
                    <h4 className="font-medium text-destructive mb-2">Data Security Risk</h4>
                    <p className="text-sm text-muted-foreground">
                      SQL injection vulnerabilities could lead to complete database compromise, exposing sensitive customer and business data.
                    </p>
                  </div>
                  <div className="bg-orange-500/10 border border-orange-500/20 p-4 rounded">
                    <h4 className="font-medium text-orange-500 mb-2">System Integrity Risk</h4>
                    <p className="text-sm text-muted-foreground">
                      Kernel vulnerabilities allow attackers to gain root access, potentially compromising entire infrastructure.
                    </p>
                  </div>
                  <div className="bg-warning/10 border border-warning/20 p-4 rounded">
                    <h4 className="font-medium text-warning mb-2">Compliance Impact</h4>
                    <p className="text-sm text-muted-foreground">
                      Security vulnerabilities may result in regulatory compliance violations and potential fines.
                    </p>
                  </div>
                </div>
              </div>
            </Card>
          </>
        )}

        {reportFormat === 'technical' && (
          <Card className="bg-secondary/30 border-l-4 border-l-primary">
            <div className="p-6">
              <h3 className="font-semibold text-lg text-foreground mb-4 flex items-center">
                <Shield className="h-5 w-5 mr-2" />
                Technical Findings
              </h3>
              <div className="space-y-4">
                {technicalFindings.map((finding) => (
                  <Card key={finding.id} className="bg-card/50 p-4">
                    <div className="space-y-3">
                      <div className="flex items-start justify-between">
                        <div className="flex-1">
                          <div className="flex items-center space-x-2 mb-2">
                            <Badge variant="outline" className="font-mono">
                              {finding.id}
                            </Badge>
                            <Badge className={`${
                              finding.severity === 'Critical' ? 'danger-glow bg-destructive' :
                              finding.severity === 'High' ? 'bg-orange-500/20 text-orange-500' :
                              'bg-warning/20 text-warning'
                            }`}>
                              {finding.severity}
                            </Badge>
                            <span className="text-sm text-muted-foreground">CVSS: {finding.cvss}</span>
                          </div>
                          <h4 className="font-medium text-foreground">{finding.title}</h4>
                          <p className="text-sm text-muted-foreground font-mono mt-1">
                            Affected: {finding.affected}
                          </p>
                        </div>
                      </div>
                      
                      <div className="space-y-2">
                        <div>
                          <h5 className="text-sm font-medium text-foreground">Impact:</h5>
                          <p className="text-sm text-muted-foreground">{finding.impact}</p>
                        </div>
                        <div className="bg-primary/10 border border-primary/20 p-3 rounded">
                          <h5 className="text-sm font-medium text-foreground mb-1">Recommendation:</h5>
                          <p className="text-sm text-muted-foreground">{finding.recommendation}</p>
                        </div>
                      </div>
                    </div>
                  </Card>
                ))}
              </div>
            </div>
          </Card>
        )}

        {reportFormat === 'compliance' && (
          <Card className="bg-secondary/30 border-l-4 border-l-accent">
            <div className="p-6">
              <h3 className="font-semibold text-lg text-foreground mb-4">Compliance Assessment</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <h4 className="font-medium text-foreground mb-3">OWASP Top 10 (2021)</h4>
                  <div className="space-y-2">
                    <div className="flex justify-between items-center">
                      <span className="text-sm">A03 - Injection</span>
                      <Badge variant="destructive">Failed</Badge>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-sm">A07 - XSS</span>
                      <Badge variant="destructive">Failed</Badge>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-sm">A01 - Access Control</span>
                      <Badge className="bg-primary/20 text-primary">Passed</Badge>
                    </div>
                  </div>
                </div>
                <div>
                  <h4 className="font-medium text-foreground mb-3">ISO 27001 Controls</h4>
                  <div className="space-y-2">
                    <div className="flex justify-between items-center">
                      <span className="text-sm">A.12.6.1 - Secure Coding</span>
                      <Badge variant="destructive">Failed</Badge>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-sm">A.13.1.1 - Network Controls</span>
                      <Badge className="bg-warning/20 text-warning">Partial</Badge>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </Card>
        )}

        {/* Action Items */}
        <Card className="bg-primary/10 border border-primary/20 mt-6">
          <div className="p-6">
            <h3 className="font-semibold text-lg text-primary mb-4">Recommended Actions</h3>
            <div className="space-y-3 text-sm">
              <div className="flex items-start space-x-3">
                <Badge className="bg-destructive text-destructive-foreground mt-0.5">1</Badge>
                <div>
                  <span className="font-medium text-foreground">Immediate (24-48 hours):</span>
                  <span className="text-muted-foreground ml-2">
                    Patch critical vulnerabilities - SQL injection and kernel exploits
                  </span>
                </div>
              </div>
              <div className="flex items-start space-x-3">
                <Badge className="bg-orange-500/20 text-orange-500 mt-0.5">2</Badge>
                <div>
                  <span className="font-medium text-foreground">Short-term (1-2 weeks):</span>
                  <span className="text-muted-foreground ml-2">
                    Address high-severity findings and implement security controls
                  </span>
                </div>
              </div>
              <div className="flex items-start space-x-3">
                <Badge className="bg-primary/20 text-primary mt-0.5">3</Badge>
                <div>
                  <span className="font-medium text-foreground">Long-term (1 month):</span>
                  <span className="text-muted-foreground ml-2">
                    Establish security monitoring and regular vulnerability assessments
                  </span>
                </div>
              </div>
            </div>
          </div>
        </Card>
      </Card>
    </div>
  );
};